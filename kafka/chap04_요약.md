# 요약

## 📌 1. 리더와 팔로워의 개념 (4.1.2)
하나의 토픽 파티션에는 리더와 팔로워가 있음.

리더는 실제로 읽기/쓰기 연산을 처리하는 주체이며 팔로워는 리더의 데이터를 복제함.

클러스터 장애 발생 시 ISR(In-Sync Replica)에 속한 팔로워 중 하나가 새로운 리더로 승격됨.

그림 4-1은 프로듀서, 컨슈머, 리더/팔로워 관계를 시각적으로 보여줌.

## 📌 2. 복제 유지와 커밋 (4.1.3)
리더와 팔로워는 ISR 그룹에 속해 안정성을 유지.

ISR에 포함되지 못한 팔로워는 리더 자격을 상실.

ISR의 동기화 상태를 통해 데이터 일관성과 무결성을 보장.

커밋(high water mark)은 모든 복제가 끝난 메시지까지의 위치를 나타냄.

컨슈머는 커밋된 메시지만 읽을 수 있음 → 메시지 불일치 방지.

## 📌 3. 리더 선출 전/후 동작 (그림 4-3)
장애로 리더가 교체되면 일부 팔로워가 리더로 승격됨.

리더 선출 이전에 읽은 메시지가 새 리더와 일치하지 않을 수 있음.

이를 통해 리더 장애 시 데이터 불일치 문제와 컨슈머 메시지 일관성 문제를 설명.

## 📌 4. 단계별 리더-팔로워 리플리케이션 동작 (4.1.4)
리더가 메시지를 오프셋에 저장 → 팔로워는 리더에서 메시지를 가져와 저장.

그림 4-4 ~ 4-7: 메시지 저장 및 복제 과정을 오프셋과 함께 시각적으로 설명.

(그림 4-4) 리더가 message1 저장, 팔로워는 아직 미복제 상태.

(그림 4-5) 팔로워가 리더에서 message1 가져와 리플리케이션.

(그림 4-6) 리더가 새로운 message2 저장 → 팔로워는 fetch 요청으로 가져옴.

(그림 4-7) 모든 팔로워가 리더와 동일한 오프셋까지 커밋 완료.

ACK 통신 없이도 안정적인 리플리케이션 구조를 구현하여 리더 부하 최소화.

## 📌 5. 리플리케이션 offset checkpoint
리더/팔로워는 replication-offset-checkpoint 파일에 마지막 커밋 위치를 기록.

이는 장애 복구 시 데이터를 어디까지 복제했는지 확인하는 역할.

## 📌 핵심 요약
Kafka는 리더와 팔로워 구조로 안정적인 데이터 처리와 복제를 보장.

ISR 그룹과 커밋 포인트를 통해 데이터 무결성과 컨슈머의 일관성을 유지.

리더 장애 시 팔로워가 신속히 리더로 승격되어 가용성을 높임.

ACK 통신을 최소화해 리더 부하를 줄이고 성능을 극대화.


